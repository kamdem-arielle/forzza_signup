<div class="cont">
    <div class="register-container">
  <h2>{{ 'register.title' | translate }}</h2>
  <p class="subtitle">{{ 'register.subtitle' | translate }}</p>

  <div *ngIf="message" class="message" [class.success]="isSuccess" [class.error]="!isSuccess">
    {{ message }}
  </div>

  <div *ngIf="isPolling" class="polling-status">
    <div class="spinner"></div>
    <div class="generated-username-box" *ngIf="generatedUsername">
      <p class="username-label">{{ 'register.yourUsername' | translate }}</p>
      <p class="username-value">{{ generatedUsername }}</p>
    </div>
    <p>{{ pollingMessage }}</p>
  </div>

  <form [formGroup]="registerForm" (ngSubmit)="onSubmit()" *ngIf="!isPolling">
    <div class="form-group">
      <label for="firstName">{{ 'register.firstName' | translate }}</label>
      <input type="text" id="firstName" formControlName="firstName" [placeholder]="('register.firstNamePlaceholder' | translate)">
      <span class="validation-error" *ngIf="registerForm.get('firstName')?.touched && registerForm.get('firstName')?.hasError('required')">
        {{ 'register.firstNameRequired' | translate }}
      </span>
    </div>

    <div class="form-group">
      <label for="lastName">{{ 'register.lastName' | translate }}</label>
      <input type="text" id="lastName" formControlName="lastName" [placeholder]="('register.lastNamePlaceholder' | translate)">
      <span class="validation-error" *ngIf="registerForm.get('lastName')?.touched && registerForm.get('lastName')?.hasError('required')">
        {{ 'register.lastNameRequired' | translate }}
      </span>
    </div>

    <div class="form-group">
      <label for="phone">{{ 'register.phone' | translate }}</label>
      <input type="tel" id="phone" formControlName="phone" [placeholder]="('register.phonePlaceholder' | translate)">
      <span class="validation-error" *ngIf="registerForm.get('phone')?.touched && registerForm.get('phone')?.hasError('required')">
        {{ 'register.phoneRequired' | translate }}
      </span>
    </div>

    <div class="form-group">
      <label for="password">{{ 'register.password' | translate }}</label>
      <div class="password-input-wrapper">
        <input [type]="showPassword ? 'text' : 'password'" id="password" formControlName="password" [placeholder]="('register.passwordPlaceholder' | translate)" (focus)="passwordFocused = true" (blur)="passwordFocused = false">
        <button type="button" class="toggle-password" (click)="togglePasswordVisibility()" tabindex="-1">
          <i [class]="showPassword ? 'fas fa-eye' : 'fas fa-eye-slash'"></i>
        </button>
      </div>
      <span class="password-hint" *ngIf="passwordFocused && !registerForm.get('password')?.hasError('strongPassword')">{{ 'register.passwordHint' | translate }}</span>
      <span class="validation-error" *ngIf="registerForm.get('password')?.touched && registerForm.get('password')?.hasError('required')">
        {{ 'register.passwordRequired' | translate }}
      </span>
      <span class="validation-error" *ngIf="registerForm.get('password')?.touched && registerForm.get('password')?.hasError('strongPassword')">
        {{ 'register.passwordWeak' | translate }}
      </span>
    </div>

    <div class="form-group">
      <label for="confirmPassword">{{ 'register.confirmPassword' | translate }}</label>
      <div class="password-input-wrapper">
        <input [type]="showConfirmPassword ? 'text' : 'password'" id="confirmPassword" formControlName="confirmPassword" [placeholder]="('register.confirmPasswordPlaceholder' | translate)">
        <button type="button" class="toggle-password" (click)="toggleConfirmPasswordVisibility()" tabindex="-1">
          <i [class]="showConfirmPassword ? 'fas fa-eye' : 'fas fa-eye-slash'"></i>
        </button>
      </div>
      <span class="validation-error" *ngIf="registerForm.get('confirmPassword')?.touched && registerForm.get('confirmPassword')?.hasError('required')">
        {{ 'register.confirmPasswordRequired' | translate }}
      </span>
      <span class="validation-error" *ngIf="registerForm.errors?.['passwordMismatch'] && registerForm.get('confirmPassword')?.touched">
        {{ 'register.passwordMismatch' | translate }}
      </span>
    </div>

    <button type="submit" [disabled]="isLoading" class="btn-primary">
      <span *ngIf="isLoading" class="btn-spinner"></span>
      {{ (isLoading ? ('register.submitting' | translate) : ('register.submitButton' | translate)) }}
    </button>
  </form>
</div>
</div>
